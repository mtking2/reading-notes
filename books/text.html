<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="theme-color" content="#111412">
    <meta name="apple-mobile-web-app-status-bar-style" content="#111412">
    <title>Reading Notes  </title>
    <link href="https://fonts.googleapis.com/css?family=Rubik" rel="stylesheet">
    <link href="https://www.starwarsfont.com/download/aurek_besh" rel="canonical">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.19.0/themes/prism-tomorrow.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.19.0/plugins/line-numbers/prism-line-numbers.min.css">
    <link rel="stylesheet" href="../main.css">
    <script src="https://www.googletagmanager.com/gtag/js?id=UA-80843466-2" async></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      gtag('config', 'UA-80843466-2');
      
    </script>
  </head>
  <body class="line-numbers">
    <div class="container">
      <div class="notes" id="text">
        <h1>
          <u>Some code</u>
        </h1>
        <hr>
        <div class="chapsums"><pre><code class="lang-ruby">module Img2Zpl
  class Image &lt; MiniMagick::Image

    def to_zpl(black_threshold: 0.5, invert: false, compress: true)
      bytes_per_row = (width % 8).positive? ? (width / 8) + 1 : (width / 8)
      byte_count = bytes_per_row * height
      data, line, previous_line, byte = '', '', '', ''

      get_pixels.each do |row|
        row.each_with_index do |column, i|
          r, g, b = column.map(&amp;:to_i)
          b_dot, w_dot = invert ? %w(1 0) : %w(0 1)
          byte &lt;&lt; ((r + g + b) &gt; (black_threshold * 765) ? b_dot : w_dot)

          if ((i+1) % 8).zero? || i == (width-1)
            line_str = byte.ljust(8, '0').to_i(2).to_s(16).upcase.rjust(2, '0')
            line &lt;&lt; line_str
            byte = ''
          end
        end

        data &lt;&lt; if compress
          (line == previous_line ? ':' : line.gsub(/0+$/, ',').gsub(/F+$/, '!'))
        else
          line
        end

        previous_line = line
        line = ''
      end

      _compress(data) if compress
      &quot;^GFA,#{byte_count},#{byte_count},#{bytes_per_row},#{data}^FS&quot;
    end

    private

    def _compression_map
      map = {}
      start = 'G'.ord
      19.times { |i| map[i + 1] = (start+i).chr }
      start = 'g'.ord
      (20..400).step(20).each_with_index { |i, j| map[i] = (start+j).chr }
      map
    end

    def _reduce(n)
      str = ''
      counts = _compression_map.keys.sort.reverse
      counts.each do |c|
        if c &lt;= n
          str &lt;&lt; (_compression_map[c])
          n -= c
        end
      end
      str
    end

    def _compress(data)
      data.gsub!(/([\da-zA-Z])(\1+)/) do |m|
        m.length == 2 ? m : &quot;#{_reduce(m.length)}#{$1}&quot;
      end
    end

  end
end

</code></pre>

        </div>
      </div>
      <footer class="dev-info">
        <div class="row flex-content-center"><a href="https://nodejs.org/"><img src="https://mtking2.github.io/assets/nodejs-light.png" alt="nodejs"></a><a href="https://pugjs.org"><img src="https://mtking2.github.io/assets/pug.svg" alt="pug"></a><a href="http://sass-lang.com/"><img src="https://mtking2.github.io/assets/sass.svg" alt="sass"></a><a href="https://validator.w3.org/nu/check/referer"><img src="https://mtking2.github.io/assets/valid-html5.png" alt="w3-validator" style="height: 2rem; margin-bottom: 2rem"></a></div>
        <div class="last-modified">
          <script>
            document.write("Last modified: " + document.lastModified + "");
            
          </script>
        </div>
      </footer>
    </div>
    <script src="https://code.jquery.com/jquery-3.4.1.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.19.0/components/prism-core.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.19.0/plugins/line-numbers/prism-line-numbers.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.19.0/plugins/copy-to-clipboard/prism-copy-to-clipboard.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.19.0/plugins/autoloader/prism-autoloader.min.js"></script>
  </body>
</html>